{{define "styles"}}
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        display: flex;
        height: 100vh;
        background: #0d1117;
        color: #e6edf3;
        overflow: hidden;
    }

    /* ===== Sidebar ===== */
    #sidebar {
        width: 340px;
        min-width: 340px;
        background: #161b22;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        border-right: 1px solid #30363d;
        z-index: 10;
    }

    #sidebar::-webkit-scrollbar { width: 6px; }
    #sidebar::-webkit-scrollbar-track { background: transparent; }
    #sidebar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

    /* ===== Panels ===== */
    .panel {
        border-bottom: 1px solid #30363d;
    }

    .panel-header {
        padding: 12px 16px;
        background: #0d1117;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        position: sticky;
        top: 0;
        z-index: 5;
    }

    .panel-header h3 {
        font-size: 0.85rem;
        font-weight: 600;
        color: #58a6ff;
        letter-spacing: 0.3px;
    }

    .panel-toggle {
        font-size: 0.7rem;
        color: #484f58;
        transition: transform 0.2s;
    }

    .panel.collapsed .panel-toggle { transform: rotate(-90deg); }
    .panel.collapsed .panel-body { display: none; }

    .panel-body {
        padding: 10px 14px 14px;
    }

    /* ===== Search ===== */
    .search-row {
        display: flex;
        gap: 6px;
    }

    .search-row input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #30363d;
        border-radius: 6px;
        background: #0d1117;
        color: #e6edf3;
        font-size: 0.85rem;
        outline: none;
        transition: border-color 0.2s;
    }
    .search-row input:focus { border-color: #58a6ff; }
    .search-row input::placeholder { color: #484f58; }

    .search-row button {
        padding: 8px 14px;
        background: #238636;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        white-space: nowrap;
    }
    .search-row button:hover { background: #2ea043; }

    #search-results {
        margin-top: 8px;
        max-height: 240px;
        overflow-y: auto;
    }

    .search-result-item {
        padding: 8px 10px;
        margin: 4px 0;
        background: #0d1117;
        border: 1px solid #21262d;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s;
        font-size: 0.82rem;
    }
    .search-result-item:hover {
        border-color: #58a6ff;
        background: #161b22;
    }
    .search-result-item .sr-name {
        font-weight: 600;
        color: #e6edf3;
    }
    .search-result-item .sr-info {
        font-size: 0.72rem;
        color: #484f58;
        margin-top: 2px;
    }

    /* ===== Layer controls ===== */
    .layer-group {
        margin-bottom: 12px;
    }

    .layer-group-title {
        font-size: 0.78rem;
        font-weight: 600;
        color: #8b949e;
        margin: 10px 0 6px;
        padding-top: 8px;
        border-top: 1px solid #21262d;
        letter-spacing: 0.3px;
    }

    .layer-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 5px 8px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.15s;
        font-size: 0.82rem;
    }

    .layer-toggle:hover { background: #21262d; }

    .layer-toggle.sub { padding-left: 4px; }
    .layer-toggle.subsub { padding-left: 24px; font-size: 0.78rem; }

    .layer-toggle input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: #58a6ff;
        cursor: pointer;
        flex-shrink: 0;
    }

    .layer-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        flex-shrink: 0;
    }

    .layer-name { color: #c9d1d9; }

    .subcategory-list {
        display: none;
        margin-left: 8px;
        padding-left: 8px;
        border-left: 2px solid #21262d;
    }
    .subcategory-list.open { display: block; }

    /* ===== Click results ===== */
    .click-params {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    .param-row {
        flex: 1;
    }

    .param-row label {
        display: block;
        font-size: 0.72rem;
        color: #8b949e;
        margin-bottom: 3px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .param-row input {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #30363d;
        border-radius: 4px;
        background: #0d1117;
        color: #e6edf3;
        font-size: 0.82rem;
        outline: none;
    }
    .param-row input:focus { border-color: #58a6ff; }

    .hint {
        font-size: 0.75rem;
        color: #484f58;
        font-style: italic;
        margin-bottom: 8px;
    }

    #click-results { max-height: calc(100vh - 480px); overflow-y: auto; }

    /* Result cards */
    .result-section {
        margin-bottom: 12px;
    }

    .result-section-title {
        font-size: 0.78rem;
        font-weight: 600;
        color: #58a6ff;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .result-section-title .count {
        background: #21262d;
        padding: 1px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        color: #8b949e;
    }

    .result-card {
        background: #0d1117;
        border: 1px solid #21262d;
        border-radius: 6px;
        padding: 8px 10px;
        margin-bottom: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.15s;
        border-left: 3px solid transparent;
    }
    .result-card:hover {
        border-color: #30363d;
        background: #161b22;
    }

    .result-card .rc-name {
        font-weight: 600;
        color: #e6edf3;
        margin-bottom: 3px;
    }

    .result-card .rc-meta {
        font-size: 0.72rem;
        color: #8b949e;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .result-card .rc-lines {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 5px;
    }

    .result-card.metro { border-left-color: #d32f2f; }
    .result-card.bus { border-left-color: #388e3c; }
    .result-card.tram { border-left-color: #f57c00; }
    .result-card.cercania { border-left-color: #7b1fa2; }
    .result-card.long_distance { border-left-color: #0288d1; }
    .result-card.train { border-left-color: #0288d1; }
    .result-card.healthcare { border-left-color: #e53935; }
    .result-card.shopping { border-left-color: #ff9800; }
    .result-card.education { border-left-color: #1976d2; }
    .result-card.leisure { border-left-color: #43a047; }
    .result-card.food_drink { border-left-color: #8d6e63; }

    .line-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
        color: #fff;
        background: #30363d;
    }

    .type-badge {
        display: inline-block;
        font-size: 0.65rem;
        padding: 2px 6px;
        border-radius: 3px;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .type-badge.metro { background: rgba(211,47,47,0.2); color: #ef5350; }
    .type-badge.bus { background: rgba(56,142,60,0.2); color: #66bb6a; }
    .type-badge.tram { background: rgba(245,124,0,0.2); color: #ffa726; }
    .type-badge.cercania { background: rgba(123,31,162,0.2); color: #ab47bc; }
    .type-badge.long_distance { background: rgba(2,136,209,0.2); color: #42a5f5; }
    .type-badge.train { background: rgba(2,136,209,0.2); color: #42a5f5; }

    /* Geocode result */
    .geocode-result {
        background: #0d1117;
        border: 1px solid #21262d;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 0.8rem;
    }
    .geocode-result .gr-row {
        display: flex;
        justify-content: space-between;
        padding: 2px 0;
    }
    .geocode-result .gr-label { color: #8b949e; }
    .geocode-result .gr-value { color: #e6edf3; font-weight: 500; }

    /* Loading */
    .loading-inline {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px;
        color: #8b949e;
        font-size: 0.8rem;
    }

    .spinner {
        width: 16px;
        height: 16px;
        border: 2px solid #30363d;
        border-top-color: #58a6ff;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .error-msg {
        padding: 8px 10px;
        background: rgba(248,81,73,0.1);
        border: 1px solid rgba(248,81,73,0.3);
        border-radius: 6px;
        color: #f85149;
        font-size: 0.78rem;
    }

    /* ===== Map ===== */
    #map-container {
        flex: 1;
        position: relative;
    }

    #map {
        width: 100%;
        height: 100%;
    }

    #map-status {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(13,17,23,0.9);
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.72rem;
        color: #8b949e;
        font-family: 'SF Mono', Monaco, monospace;
        z-index: 5;
        display: flex;
        gap: 12px;
    }

    /* Mapbox popup dark theme */
    .mapboxgl-popup-content {
        background: #161b22 !important;
        color: #e6edf3 !important;
        padding: 12px 14px !important;
        border-radius: 8px !important;
        border: 1px solid #30363d !important;
        min-width: 200px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.4) !important;
    }

    .mapboxgl-popup-close-button {
        color: #8b949e !important;
        font-size: 18px !important;
        right: 6px !important;
        top: 4px !important;
    }

    .mapboxgl-popup-tip {
        border-top-color: #161b22 !important;
    }

    .popup-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #58a6ff;
        margin-bottom: 4px;
    }

    .popup-type {
        font-size: 0.7rem;
        text-transform: uppercase;
        color: #8b949e;
        margin-bottom: 6px;
    }

    .popup-detail {
        font-size: 0.78rem;
        color: #c9d1d9;
        margin-bottom: 2px;
    }

    .popup-lines {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 6px;
    }

    /* Click marker */
    .click-marker {
        width: 20px;
        height: 20px;
        background: #58a6ff;
        border: 3px solid #fff;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(88,166,255,0.6);
        animation: pulse-marker 2s ease infinite;
    }

    @keyframes pulse-marker {
        0%, 100% { box-shadow: 0 0 12px rgba(88,166,255,0.6); }
        50% { box-shadow: 0 0 20px rgba(88,166,255,0.9); }
    }

    /* Station markers on map */
    .station-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 2px solid #fff;
        cursor: pointer;
        box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }

    .station-dot.metro { background: #d32f2f; }
    .station-dot.bus { background: #388e3c; }
    .station-dot.tram { background: #f57c00; }
    .station-dot.cercania { background: #7b1fa2; }
    .station-dot.long_distance, .station-dot.train { background: #0288d1; }

    /* POI markers */
    .poi-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        border: 1px solid rgba(255,255,255,0.7);
        cursor: pointer;
    }

    .poi-dot.healthcare { background: #e53935; }
    .poi-dot.shopping { background: #ff9800; }
    .poi-dot.education { background: #1976d2; }
    .poi-dot.leisure { background: #43a047; }
    .poi-dot.food_drink { background: #8d6e63; }

    /* Radius circle */
    .radius-info {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(13,17,23,0.9);
        padding: 6px 14px;
        border-radius: 6px;
        font-size: 0.78rem;
        color: #8b949e;
        z-index: 5;
        display: none;
        gap: 14px;
        border: 1px solid #30363d;
    }

    .radius-info.visible { display: flex; }
    .radius-info .ri-highlight { color: #58a6ff; font-weight: 600; }

    /* ===== Right Data Sidebar ===== */
    #data-sidebar {
        width: 380px;
        min-width: 380px;
        background: #161b22;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        border-left: 1px solid #30363d;
        z-index: 10;
        transition: width 0.2s, min-width 0.2s;
    }
    #data-sidebar.collapsed {
        width: 0;
        min-width: 0;
        overflow: hidden;
    }
    #data-sidebar::-webkit-scrollbar { width: 6px; }
    #data-sidebar::-webkit-scrollbar-track { background: transparent; }
    #data-sidebar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 3px; }

    .ds-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: #0d1117;
        border-bottom: 1px solid #30363d;
        position: sticky;
        top: 0;
        z-index: 5;
    }
    .ds-header h3 {
        font-size: 0.85rem;
        font-weight: 600;
        color: #58a6ff;
        letter-spacing: 0.3px;
        white-space: nowrap;
    }
    .ds-toggle {
        background: none;
        border: 1px solid #30363d;
        color: #8b949e;
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.15s;
    }
    .ds-toggle:hover { border-color: #58a6ff; color: #58a6ff; }

    .ds-section {
        border-bottom: 1px solid #30363d;
    }
    .ds-section-header {
        padding: 10px 16px;
        background: #0d1117;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        font-size: 0.82rem;
        font-weight: 600;
        color: #c9d1d9;
    }
    .ds-section-header:hover { background: #161b22; }
    .ds-section.collapsed .ds-section-body { display: none; }

    .ds-count {
        background: #21262d;
        padding: 1px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        color: #8b949e;
        font-weight: 400;
    }

    .ds-section-body {
        padding: 0;
    }

    .ds-list {
        padding: 6px 10px;
    }

    .ds-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        color: #8b949e;
        font-size: 0.8rem;
    }

    .ds-load-more {
        padding: 8px 16px 12px;
        text-align: center;
    }
    .ds-load-more button {
        background: #21262d;
        border: 1px solid #30363d;
        color: #58a6ff;
        padding: 6px 16px;
        border-radius: 6px;
        font-size: 0.78rem;
        cursor: pointer;
        transition: all 0.15s;
        width: 100%;
    }
    .ds-load-more button:hover {
        background: #30363d;
        border-color: #58a6ff;
    }

    /* Data sidebar cards */
    .ds-card {
        background: #0d1117;
        border: 1px solid #21262d;
        border-radius: 6px;
        padding: 10px 12px;
        margin-bottom: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.15s;
        border-left: 3px solid transparent;
    }
    .ds-card:hover {
        border-color: #30363d;
        background: #161b22;
    }
    .ds-card.metro { border-left-color: #d32f2f; }
    .ds-card.bus { border-left-color: #388e3c; }
    .ds-card.tram { border-left-color: #f57c00; }
    .ds-card.cercania { border-left-color: #7b1fa2; }
    .ds-card.long_distance { border-left-color: #0288d1; }
    .ds-card.train { border-left-color: #0288d1; }
    .ds-card.healthcare { border-left-color: #e53935; }
    .ds-card.shopping { border-left-color: #ff9800; }
    .ds-card.education { border-left-color: #1976d2; }
    .ds-card.leisure { border-left-color: #43a047; }
    .ds-card.food_drink { border-left-color: #8d6e63; }

    .ds-card-name {
        font-weight: 600;
        color: #e6edf3;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .ds-card-meta {
        font-size: 0.72rem;
        color: #8b949e;
        margin-bottom: 4px;
    }
    .ds-card-meta span { margin-right: 10px; }
    .ds-card-lines {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 5px;
    }
    .ds-card-detail {
        font-size: 0.72rem;
        color: #8b949e;
        padding: 2px 0;
    }
    .ds-card-detail .dl { color: #484f58; }
    .ds-card-detail .dv { color: #c9d1d9; }
    .ds-card-stars {
        color: #f5a623;
        font-size: 0.78rem;
        margin-top: 2px;
    }
</style>
{{end}}
